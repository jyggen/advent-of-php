#!/usr/bin/env php
<?php

/*
 * This file is part of boo/release.
 *
 * (c) Jonas Stendahl <jonas@stendahl.me>
 *
 * This source file is subject to the MIT license that is bundled
 * with this source code in the file LICENSE.
 */

namespace Boo\AdventOfCode;

use ErrorException;

\set_error_handler(function ($severity, $message, $file, $line): void {
    if ($severity & \error_reporting()) {
        throw new ErrorException($message, 0, $severity, $file, $line);
    }
});

\chdir(\dirname(__DIR__));

require_once 'vendor/autoload.php';

$year = $argv[1] ?? null;
$day = $argv[2] ?? null;

if (null === $year || null === $day) {
    exit("You must supply a year and a day, run the script like this:\n> ".$argv[0]." 2017 1\n");
}

$paddedDay = \str_pad($day, 2, '0', STR_PAD_LEFT);
$inputDir = \sprintf('resources/inputs/Year%s', $year);
$inputFile = \sprintf('%s/Day%s.txt', $inputDir, $paddedDay);

if (false === \is_dir($inputDir)) {
    \mkdir($inputDir, null, true);
}

if (false === \is_file($inputFile)) {
    \touch($inputFile);
}

$templateVars = ['day' => $day, 'day_padded' => $paddedDay, 'year' => $year];
$loader = new \Twig_Loader_Filesystem('resources/templates');
$twig = new \Twig_Environment($loader, [
    'auto_reload' => true,
    'strict_variables' => true,
]);

$classDir = \sprintf('src/Year%s', $year);
$classFile = \sprintf('%s/Day%s.php', $classDir, $paddedDay);

if (false === \is_dir($classDir)) {
    \mkdir($classDir, null, true);
}

if (false === \is_file($classFile)) {
    \file_put_contents($classFile, $twig->render('Day.php.twig', $templateVars));
}

$testDir = \sprintf('tests/Year%s', $year);
$testFile = \sprintf('%s/Day%sTest.php', $testDir, $paddedDay);

if (false === \is_dir($testDir)) {
    \mkdir($testDir, null, true);
}

if (false === \is_file($testFile)) {
    \file_put_contents($testFile, $twig->render('DayTest.php.twig', $templateVars));
}
